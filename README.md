r3e-open-championship
=====================

Open Championship Statistics for [R3E](http://game.raceroom.com)
Â© 2015-2023 by Christoph Kubisch

### About

This is a small tool that parses the raceresult file from R3E and generates a tiny database and a html report for a championship based on multiple single race events (single- or multiplayer). It is not supported nor in anyway endorsed by the creators of R3E.

The tool supports either the raceresults.txt generated by R3E or json files by the server api.

![sample output](https://github.com/pixeljetstream/r3e-open-championship/blob/master/doc/samplesm.png)

As you can see at this [full sample website](http://htmlpreview.github.io/?https://github.com/pixeljetstream/r3e-open-championship/blob/master/doc/sample.html) it generates for every race:

* Driver Standings
* Team Standings (if more than one team)
* Vehicle Standings (if more than one vehicle type)
* Best Race Lap Times
* Best Qualification Times
* Detailed Race Results

### How it works 

#### Local Results

*TEMPORARY CHANGE*: Due to incompatibilities with new game version, use the server results way and not the UI application.

This means following actions:

* Find the txt files inside `"My Documents\My Games\SimBin\RaceRoom Racing Experience\UserData\Log\Results"` which contains the results of the last completed race (no matter what kind of race it was).
* Use the commandline or provided batch files similar to the server results.
* WARNING: That means there is no longer an automatic detection of who you race against to get consistent seasons. You have to watch for which result files you apply to the batch file.
  Future version should bring back the live tracking of new result files and auto detecting the field so you don't have to.

As the raceroom developer is still making changes to the results output, further changes may need to be done to account for this.

#### Server Results

* For Multiplayer races it is highly recommended to pass the server generated result files (json or xml) and use the commandline mode, as it gives more control than the UI.

If you do not want to setup the commandline yourself, simply use the `myleague.bat`:

`myleague.bat 201602031038.json`

* Pass the json or xml file that the server generates onto it, for example drag drop the result file (json or xml) onto the batch file.
* This will append the results to a database called `myleague` and the result html is generated and then shown in your default browser. 
* By renaming the batch file, for example `GTR3 Summer Season.bat` you will also rename the database being used. So simply copy the batch file, rename it to the league it shall represent, and pass the result files onto it.
* Every time you pass a result file onto the batch, it will get appended to the database of that filename, so races only need to be added once.

### Commandline mode

In commandline mode, the ui is not started and core functionality is exposed.

* `-addrace dataBaseFile raceresultsFile`
  Appends the race to the provided database file (no error checking whether it 
  contains drivers from the race or not).

* `-makehtml dataBaseFile htmlFile`
  Generates html results for the provided database file
  
* `-config "lua string"`
  Applies the lua string, overwriting the current settings. For example use `-config "ruleset='fia1962_1990'"` to apply old rulepoints prior adding a race to your custom season.
  
* `-configfile luaFile`
  Applies the config from this file, overwriting the current settings. By default `config.lua` is loaded.
  
For example:

One should prefer using luajit as startup, as it will print error outputs to console.

The following can be used as a batch file for managing multiplayer seasons.

```
luajit.exe r3e-open-championship.lua -config "ruleset='%3'" -addrace ./results/%1.lua %2 -makehtml ./results/%1.lua ./results/%1.html
```

The batch file expects three arguments, season file, result file (json, xml or txt) and ruleset for points in that race. It will add the results to the season and update the appropriate html file in the "results" subdirectory.

`mybatch.bat mygroup5 lastrace.json fia1962_1990`


### Configuration

To modify the HTML styling it's best to edit the `_style.css` file in '/results' or change the reference to your own file below. For league races it's recommended to disable the '#player' highlight color.

In the `config.lua` there is a few settings you can play with that affect the html generation:

* useicons: for track and car
* onlyicons: don't print text if icon exists
* driver_standings_vehicle: add vehicle column in driver standings
* driver_standings_team: add team column in driver standings
* vehicle_standings: print standings based on vehicle (automatically omitted if only one vehicle exists)
* team_standings: print standings based on teams (automatically omitted if only one team exists)
* stylesheetfile: change the default filename
* rulepoints: the table that is used to assign points to the drivers. The default entry must be provided, all others are optional, you can define your own analog to the ones that already exist. Just make sure the "ruleset" of a race within the easons matches an entry of the rulepoints table.

### History

Time-line for some distinct features
* 03.05.2023 - start supporting new raceroom local result files for commandline mode (still subject to improvements)
* 28.12.2021 - the "Rebuild all HTML stats" function generates a `index.html` page in the output directory (thx to contribution by **blgk**) 
* 30. 9.2021 - json and xml fixes for latest file formating, base results on player.Position if exists, json/xml add support for race2 and race3
* 28. 2.2016 - xml result support, use time difference for best-lap and qualifying
*  6. 2.2016 - bugfix results when drivers are laps behind, remove minracetime check for json
* 17. 1.2016 - config file externalized, new config commandline, point handling per race
* 10. 1.2016 - json result bugfix racefinish state, config to disable team/vehicle standings
*  7.11.2015 - json result support to improve multiplayer usage
* 20. 6.2015 - multiplayer-friendly commandline options, and database override
* 14. 6.2015 - modified css styles a bit, allow position-based color-coding
* 13. 6.2015 - added icons for tracks and vehicles
* 16. 1.2015 - added optional description string for a championship
* 10. 1.2015 - added qual times, race results and driver standings with positions
*  9. 1.2015 - added team and car standings, as well as best laptimes
*  4. 1.2015 - first release, track multiple championship, html report for driver standings

### Third Party

Special thanks to **tAz-07** and **heppsan** from steam community on feedback and providing most of the track mappings. **ttfredo** and **Nicklas Petersson** from kwstudios forum for bug reproducers.

The icons are directly linked to the official game website.

The exe and wx dll were compressed via upx, the exe automatically executes the r3e-open-championship.lua file.

* [wxLua](http://wxlua.sourceforge.net/)
* [md5.lua](https://github.com/kikito/md5.lua)
* [upx](http://sourceforge.net/projects/upx/)
* [cjson](http://www.kyne.com.au/~mark/software/lua-cjson.php)
* [luajit](http://luajit.org/)
